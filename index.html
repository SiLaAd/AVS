<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="de">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <script src="js/Ajax.js"></script>
    <script src="js/Writer.js"></script>
    <title>Aufgabe 1</title>
</head>

<body>
   

    User:
    <input type="text" name="username" id="username" />
    <br><br>

    Passwort:
    <input type="text" name="password" id="password" />
    <br><br>       

    <button type="button" onclick="registerData();">Register</button>
    <button type="button" onclick=queryData();>Query</button>
    <button type="button" onclick="deleteData();">Delete</button>


    <script type="text/javascript">
        
        /*
         * Generiert eine zufällige IP als Dummy-Daten
         * @returns {String}    zufällig generierte IP Adresse
         */
        function generateRanIp() {
            var ipAdresse =  Math.round(Math.random() * (256 - 1) + 1) + "." 
                    + Math.round(Math.random() * (256 - 1) + 1) + "." 
                    + Math.round(Math.random() * (256 - 1) + 1) + "." 
                    + Math.round(Math.random() * (256 - 1) + 1);
            return ipAdresse;
        }

        /*
         * Speichert die übertragenen Daten in Textdateien.
         * Jeder Nutzer bekommt eine eigene Textdatei, in der die IP hinterlegt wird.
         * Anschließend werden die Daten auf der Konsole ausgegeben.
         */
        function registerData(){
            var username = document.getElementById("username").value;
            var password = document.getElementById("password").value;
            var pcName = "Client" + "_" + Math.round(Math.random() * (10000 - 1) + 10000);
            var ipAdress = generateRanIp();

            var URL = "http://localhost/AVS/sendData.php";
            var ajaxCom= new Ajax(URL,receive);
            // expected components (checked in receive())
            receivedObj= {"username" : 0, "password" : 0, "ipAdress" : 0, "pcName" : 0};
            ajaxCom.send({
                "username": username,
                "password": password,
                "ipAdress": ipAdress,
                "pcName": pcName
            }
            );
            
            write2console(receivedObj.username);
            write2console(receivedObj.password);
            write2console(receivedObj.ipAdress);
            write2console(receivedObj.pcName);
            
            ajaxCom.disconnect();
        }
       
        /*
         * Funktion zum Abruf des Serverarrays. Diese Funktion liefert alle angemeldeten Server.
         */
        function queryData(){
            var files;
            var URL = "http://localhost/AVS/requestData.php";
            var ajaxCom= new Ajax(URL,receive);
            // expected components (checked in receive())
            receivedObj= {"files" : 0};
            ajaxCom.send({
                "files": files
            }
            );
            
            write2console(receivedObj.files);
            
            ajaxCom.disconnect();
        }
        
        /*
         * Löscht die Textdateien der registrierten Nutzer.
         * Wird im Feld User ein Name angegeben, wird nur der angegebene User gelsöcht.
         * Wird das Feld User freigelassen, werden alle Nutzer gelöscht.
         */
        function deleteData(){
            var username = document.getElementById("username").value;
            var URL = "http://localhost/AVS/deleteData.php";
            var ajaxCom= new Ajax(URL,receive);
            
            // expected components (checked in receive())
            receivedObj= {"username" : 0};
            ajaxCom.send({
                "username": username
            });
            
            ajaxCom.disconnect();
	}
    </script>

</body>

</html>
